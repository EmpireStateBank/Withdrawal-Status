<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Withdrawal Status</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #f4f8fb;
      margin: 0;
      min-height: 100vh;
    }
    .container {
      max-width: 400px;
      background: white;
      margin: 56px auto 0 auto;
      border-radius: 10px;
      box-shadow: 0 3px 16px rgba(0,0,0,0.11);
      padding: 32px;
    }
    h2 {
      text-align: center;
      margin-top: 0;
      color: #233;
    }
    input[type="password"] {
      width: 100%;
      font-size: 1.7em;
      letter-spacing: 1em;
      padding: 12px;
      margin-bottom: 16px;
      box-sizing: border-box;
      border: 1px solid #b5bac8;
      border-radius: 6px;
      text-align: center;
      background: #f8fafc;
    }
    button {
      width: 100%;
      background: #3885f7;
      color: white;
      border: 0;
      border-radius: 6px;
      padding: 13px 0;
      font-size: 1.15em;
      cursor: pointer;
      margin-top: 6px;
      margin-bottom: 8px;
      font-weight: 500;
      transition: background .18s;
    }
    button:hover {
      background: #2769bd;
    }
    .error {
      color: #d01c2a;
      text-align: center;
      margin-bottom: 10px;
      min-height: 18px;
    }
    .loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 28vh 0 0 0;
    }
    .spinner {
      border: 6px solid #e3e5ed;
      border-top: 6px solid #3885f7;
      border-radius: 50%;
      width: 38px;
      height: 38px;
      margin-bottom: 18px;
      animation: spin 0.85s linear infinite;
    }
    @keyframes spin {
      0% {transform: rotate(0deg);}
      100% {transform: rotate(360deg);}
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 18px;
      margin-bottom: 15px;
    }
    th, td {
      border-bottom: 1px solid #e7e9ee;
      padding: 8px;
      text-align: center;
    }
    th {
      background: #f5f7fa;
      color: #333;
    }
    tr:last-child td {
      border-bottom: none;
    }
    .status {
      font-weight: 500;
    }
    .ok { color: #249a41;}
    .pending { color: #f9a603;}
    .fail, .refund { color: #d01c2a; }
    .logout-btn {
      background: #ccd4e5;
      color: #223;
      font-size: 0.99em;
      margin-top: 15px;
      transition: background .18s, color .14s;
    }
    .logout-btn:hover { background: #b2bed8; color: #090e19;}
    .info-message {
      max-width: 400px;
      margin: 10vw auto 0 auto;
      background: #fff7e5;
      color: #673f09;
      border: 1px solid #f4e0b3;
      border-radius: 9px;
      text-align: center;
      padding: 35px 18px 34px 18px;
      font-size: 1.21em;
      box-shadow: 0 2px 8px rgba(194,140,2,0.07);
    }
    @media (max-width: 600px) {
      .container, .info-message {
        margin: 32px 6px 0 6px;
        padding: 16px;
      }
      table, th, td {
        font-size: 15px;
      }
      h2 { font-size: 1.25em;}
    }
  </style>
</head>
<body>
  <div id="main"></div>
  <script>
    // First, check UTC time
    function isAfter18UTC() {
      const now = new Date();
      const hour = now.getUTCHours();
      return hour >= 18;
    }

    function showTimeMessage() {
      document.getElementById('main').innerHTML = `
        <div class="info-message">
          Withdrawal status is only available<br>from <b>18:00 UTC</b> onward.<br>
          <div style="margin-top:13px;font-size:.99em;">
            Current UTC Time: <span id="utc-time"></span>
          </div>
        </div>
      `;
      // live update UTC time
      function updateTime() {
        const now = new Date();
        const pad = n => n.toString().padStart(2,'0');
        document.getElementById('utc-time').textContent =
          pad(now.getUTCHours())+':'+pad(now.getUTCMinutes())+':'+pad(now.getUTCSeconds());
      }
      updateTime();
      setInterval(updateTime, 1000);
    }

    if (!isAfter18UTC()) {
      showTimeMessage();
    } else {
      // ---- WITHDRAWAL LOGIC BELOW ----
      // Withdrawal data, mapped by PIN
      const withdrawalRecords = {
        "3572": [
          { date: "2025-11-01", amount: 5000, status: "Withdraw successful" },
          { date: "2025-11-02", amount: 8000, status: "Fail" },
          { date: "2025-11-02", amount: 8000, status: "Refund" },
        ],
        "4073": [
          { date: "2025-09-04", amount: 7000, status: "Fail" },
          { date: "2025-11-05", amount: 7000, status: "Refund" },
        ],
        "1313": [
          { date: "2025-09-01", amount: 7000, status: "Withdraw successful" },
        ],
        "5012": [
          { date: "2025-09-03", amount: 17000, status: "Fail" },
          { date: "2025-11-03", amount: 17000, status: "Refund" },
        ],
        "1266": [
          { date: "2025-11-04", amount: 250, status: "Withdraw successful" },
        ],
        "1220": [
          { date: "2025-11-06", amount: 300, status: "Fail" },
        ],
        "2019": [
          { date: "2025-11-04", amount: 9000, status: "Fail" },
          { date: "2025-11-05", amount: 9000, status: "Refund" },
        ],
        "1908": [
          { date: "2025-09-12", amount: 7000, status: "Fail" },
          { date: "2025-11-05", amount: 7000, status: "Refund" },
          { date: "2025-11-13", amount: 2000, status: "Pending" },
        ],
        "4173": [
          { date: "2025-11-05", amount: 500, status: "Withdraw successful" },
        ],
      };

      const pinStatusClass = status =>
        status === "Withdraw successful" ? "ok"
          : status === "Pending" ? "pending"
          : status === "Fail" ? "fail"
          : status === "Refund" ? "refund"
          : "";

      const main = document.getElementById('main');

      // State
      let state = "init-loading"; // init-loading, pin, loading, status
      let errorMsg = "";
      let currentPin = "";

      // Render functions
      function showLoading(text) {
        main.innerHTML = `
          <div class="loading">
            <div class="spinner"></div>
            <div>${text || "Loading..."}</div>
          </div>
        `;
      }

      function showPinInput() {
        main.innerHTML = `
          <div class="container">
            <h2>Enter Your PIN</h2>
            <div class="error">${errorMsg || "&nbsp;"}</div>
            <form id="pin-form" autocomplete="off">
              <input
                type="password"
                pattern="\\d{4}"
                maxlength="4"
                placeholder="4-digit PIN"
                inputmode="numeric"
                id="pin-input"
                required
              /><br>
              <button type="submit">Submit</button>
            </form>
          </div>
        `;

        setTimeout(() => {
          const pinInput = document.getElementById('pin-input');
          if(pinInput) pinInput.focus();
        }, 200);

        document.getElementById('pin-form').onsubmit = function(e) {
          e.preventDefault();
          const enteredPin = document.getElementById('pin-input').value.trim();
          if (withdrawalRecords.hasOwnProperty(enteredPin)) {
            errorMsg = "";
            currentPin = enteredPin;
            state = "loading";
            render();
            setTimeout(() => {
              state = "status";
              render();
            }, 6000);
          } else {
            errorMsg = "Invalid PIN. Please try again.";
            render();
          }
        };
      }

      function showStatus() {
        const records = withdrawalRecords[currentPin];
        let rows = "";
        if(records && records.length) {
          rows = records.map(r =>
            `<tr>
              <td>${r.date}</td>
              <td>â‚¦${r.amount}</td>
              <td class="status ${pinStatusClass(r.status)}">${r.status}</td>
            </tr>`
          ).join("");
        }

        main.innerHTML = `
          <div class="container">
            <h2>Withdrawal Status</h2>
            <table>
              <thead>
                <tr><th>Date</th><th>Amount</th><th>Status</th></tr>
              </thead>
              <tbody>
                ${rows}
              </tbody>
            </table>
            <button class="logout-btn" id="logout-btn">Log out</button>
          </div>
        `;

        document.getElementById('logout-btn').onclick = function() {
          state = "pin";
          errorMsg = "";
          currentPin = "";
          render();
        }
      }

      function render() {
        if (state === "init-loading") {
          showLoading("Preparing Withdrawal Status...");
          setTimeout(() => {
            state = "pin";
            render();
          }, 1500);
        }
        else if (state === "pin") showPinInput();
        else if (state === "loading") showLoading("Verifying PIN and fetching withdrawal records...");
        else if (state === "status") showStatus();
      }

      // Init
      render();
      // ---- END WITHDRAWAL LOGIC ----
    }
  </script>
</body>
</html>
